<!DOCTYPE html>
<head>
  <title>Movie Reviews</title>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tabletop.js/1.4.3/tabletop.min.js"></script>
  <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
  <script type="text/javascript" src="https://cdn.datatables.net/1.10.10/js/jquery.dataTables.min.js"></script>
  <script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <script type='text/javascript' src='http://graphics.rhoworld.com/src/webcharts/webcharts.v1.6.0.js'></script>

  <link rel="stylesheet" href="https://cdn.datatables.net/1.10.12/css/jquery.dataTables.min.css">  
  <link rel="stylesheet" href="https://graphics.rhoworld.com/src/webcharts/webcharts.v1.4.0.css">
  <link rel="stylesheet" type="text/css" href="movies.css">
</head>

<html>
<body>
  <h2>Movie Comparison</h2>
  <h4>Overview</h4>
  <p>My friend Sasha said, "Naama and I have the most similar taste in movies." This is my attempt to prove him wrong (and play with a few graphics/machine learning things over my company's winter break). 
  
  <h4>Data</h4> 
  12 people filled out a google spreadsheet rating 50 movies on a scale of 1 (worst) to 5 (best). People were instructed to leave rankings blank if they haven't seen the movie. <a href="https://goo.gl/forms/oMmsbm874ns6K8qZ2">Here</a> is a link to the survey (feel free to fill it out to see how you compare!), and <a href="https://docs.google.com/spreadsheets/d/1i_W-vL3MXEEh_R3PGs9acXM_6Y4gE2YTCUKnwaxjttU/">here</a> is a link to the results, saved as a google spreadsheet.

  <h4>Hierarchical Clustering</h4>
  <p> First thing, here is a quick heatmap (<a href="cluster/PHMovies.png">pdf</a>, <a href="cluster/PHMovies.R">R code</a>). The R code was adapted from this <a href="http://sebastianraschka.com/Articles/heatmaps_in_r.html"> nice tutorial.</a></p>
  <img src="cluster/PHMovies.png" width=1000px>

  <p> More stuff coming someday (?) ... </p>
  
</body>
</html>

<script type="text/javascript">
$(document).ready(function() {

  //constants and selectors
  var public_spreadsheet_url = 
  '1i_W-vL3MXEEh_R3PGs9acXM_6Y4gE2YTCUKnwaxjttU';

  //Histogram settings
  var dotsSettings = {
    "width":"800",
    "height": "1000",
    resizable:false,
    "x":{
      "label":"Rating",
      "type":"linear",
      "column":"score",
   //   "domain": d3.range(1,5,1).map(function(d){return d3.format("0.0f")(d)+""})
    },
    "y":{
      "type":"ordinal",
      "label":"Movie",
      "column":"movie"
    },
    "marks":[
      {
        "type":"line",
        "per":["movie"],
        "attributes":{"fill":"black","stroke":"black", "fill-opacity":0.2}
      },
      {
        "type":"circle",
        "per":["movie"],
        "summarizeX":"mean",
        "attributes":{"fill":"red","stroke":"red", "fill-opacity":0.9}
      },
    ],
    "gridlines":"y"
  };

  ///////////////
  // Functions //
  ///////////////

  function prepData(data){

    var longData = []
    var movies = Object.getOwnPropertyNames(data[1]).slice(2)

    console.log(movies)
    data.forEach(function(d){
      console.log(d)
      movies.forEach(function(m){
        longData.push({
          person:d["Who are you? "],
          movie:m,
          score:+d[m]
        })
      })
    })
    longData = longData.filter(function(d){return d.score>=1})
    return longData;
  }

  function initPage(data, tabletop){
    console.log(data)
    //prepare the data
    var longData = prepData(data)
    console.log(longData)
    //initialize the histogram
    dots.init(longData);

    //initialize dataTables
   // drawTable(clean)
  }

  var dots = webCharts.createChart(".chart", dotsSettings,null);
  Tabletop.init({ 
    key: public_spreadsheet_url,
    callback: initPage,
    simpleSheet: true 
  })
})

</script>


